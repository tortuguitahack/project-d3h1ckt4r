{\n  "name": "01-Ebooks-Persuasivos-Ultra",\n  "active": false,\n  "nodes": [\n    {\n      "id": "trigger-cron-daily",\n      "name": "üìÖ Daily Trigger",\n      "type": "n8n-nodes-base.cron",\n      "position": [ -400, 0 ],\n      "typeVersion": 1,\n      "parameters": {\n        "cronExpression": "0 8 * * *",\n        "timezone": "UTC"\n      },\n      "notes": "Main daily report trigger"\n    },\n    {\n      "id": "webhook-setup-safe",\n      "name": "üõ°Ô∏è Safe Setup Webhook",\n      "type": "n8n-nodes-base.webhook",\n      "typeVersion": 1,\n      "position": [ -200, 200 ],\n      "parameters": {\n        "httpMethod": "POST",\n        "path": "setup-credentials",\n        "authentication": "basicAuth",\n        "options": { "rawBody": true }\n      },\n      "notes": "Validates HMAC signature and schema before decrypt"\n    },\n    {\n      "id": "decrypt-payload",\n      "name": "üîê Decrypt (Function)",\n      "type": "n8n-nodes-base.function",\n      "typeVersion": 1,\n      "position": [ 0, 200 ],\n      "parameters": {\n        "functionCode": "// Expecting encrypted_payload in $json. Verify schema upstream. Decrypt using env key.\nconst crypto = require('crypto');\nconst payload = $json.encrypted_payload || null;\nif (!payload) throw new Error('Missing encrypted_payload');\nconst key = process.env.N8N_LOCAL_DECRYPT_KEY;\nif (!key) throw new Error('Missing env N8N_LOCAL_DECRYPT_KEY');\n// placeholder for decryption logic; keep keys out of repo\n// const decrypted = decrypt(payload, key);\nconst decrypted = payload; // TODO: replace with real decryption implementation\nreturn [{ json: JSON.parse(decrypted) }];"\n      },\n      "notes": "Placeholder decryption; implement KMS or local key retrieval via env variable"\n    },\n    {\n      "id": "airtable-summary",\n      "name": "üìä Airtable Summary (Read)",\n      "type": "n8n-nodes-base.airtable",\n      "typeVersion": 2.1,\n      "position": [ 200, 0 ],\n      "parameters": {\n        "resource": "base",\n        "operation": "getSchema",\n        "base": { "__rl": true, "mode": "list", "value": "{{$env.AIRTABLE_BASE_ID}}" }\n      },\n      "credentials": { "airtableTokenApi": { "id": "{{AIRTABLE_CRED_ID}}", "name": "Airtable Personal Access Token" } },\n      "notes": "Use credential reference and AIRTABLE_BASE_ID env var"\n    },\n    {\n      "id": "calc-master",\n      "name": "üßÆ Calc Master",\n      "type": "n8n-nodes-base.code",\n      "typeVersion": 2,\n      "position": [ 400, 0 ],\n      "parameters": {\n        "jsCode": "// normalize and compute report fields\nreturn $input.all().map(item => { const j = item.json; return { json: { fecha: j.fecha || new Date().toISOString().slice(0,10), activos: Number(j.activos||0), total_sistemas: Number(j.total_sistemas||0), ingreso_diario: Number(j.ingreso_diario||0), proyectado_mensual: Number(j.proyectado_mensual||0) } } });"\n      },\n      "notes": "Ensure numeric types and defaults"\n    },\n    {\n      "id": "email-report",\n      "name": "üìß Email Report",\n      "type": "n8n-nodes-base.emailSend",\n      "typeVersion": 2.1,\n      "position": [ 600, 0 ],\n      "parameters": {\n        "fromEmail": "{{$env.REPORT_FROM_EMAIL}}",\n        "toEmail": "{{$env.REPORT_TO_EMAIL}}",\n        "subject": "üöÄ ULTRA GOD REPORT - D√çA {{$json.fecha}}",\n        "html": "<h2>Resumen Maestro - {{$json.fecha}}</h2>\n<ul>\n  <li>Sistemas activos: {{$json.activos}} / {{$json.total_sistemas}}</li>\n  <li>Ingreso diario: {{$json.ingreso_diario}}</li>\n  <li>Mes proyectado: {{$json.proyectado_mensual}}</li>\n</ul>\n<p>Generado por workflow: 01-Ebooks-Persuasivos-Ultra</p>",\n        "options": {}\n      },\n      "credentials": { "smtp": { "id": "{{$env.SMTP_CRED_ID}}", "name": "SMTP account" } },\n      "notes": "Uses env vars for emails and smtp credentials; template sanitized"\n    },\n    {\n      "id": "slack-notify",\n      "name": "üí¨ Slack Master",\n      "type": "n8n-nodes-base.slack",\n      "typeVersion": 2.3,\n      "position": [ 800, 0 ],\n      "parameters": {\n        "text": "üöÄ DAILY: {{$json.ingreso_diario}} | Activos: {{$json.activos}}/{{$json.total_sistemas}} | Mes: {{$json.proyectado_mensual}}",\n        "otherOptions": {}\n      },\n      "notes": "Notify Slack channel on success"\n    },\n    {\n      "id": "gpt-social",\n      "name": "üß† GPT Social (OpenAI)",\n      "type": "n8n-nodes-base.openAi",\n      "typeVersion": 1,\n      "position": [ -200, 600 ],\n      "parameters": {\n        "model": "gpt-4",\n        "options": {},\n        "requestOptions": { "timeout": 30000 }\n      },\n      "notes": "Add safe parsing and fallback to gpt-3.5 if gpt-4 fails"\n    },\n    {\n      "id": "platform-selector",\n      "name": "üé≤ Platform Selector",\n      "type": "n8n-nodes-base.code",\n      "typeVersion": 2,\n      "position": [ -400, 600 ],\n      "parameters": {\n        "jsCode": "const platforms = [{platform:'Twitter',max:280},{platform:'LinkedIn',max:1300}];\nconst pick = platforms[Math.floor(Math.random()*platforms.length)];\nreturn [{json:{platform:pick.platform,max_length:pick.max}}];"\n      },\n      "notes": "Select platform and enforce length limits"\n    },\n    {\n      "id": "gpt-code",\n      "name": "üß† GPT Code",\n      "type": "n8n-nodes-base.openAi",\n      "typeVersion": 1,\n      "position": [ 0, 1100 ],\n      "parameters": { "model": "gpt-4", "options": {}, "requestOptions": {} },\n      "notes": "Use for code generation with length and safety checks"\n    },\n    {\n      "id": "on-error-workflow",\n      "name": "üî• On Error Handler",\n      "type": "n8n-nodes-base.function",\n      "typeVersion": 1,\n      "position": [ 1000, 1400 ],\n      "parameters": {\n        "functionCode": "// Centralized error handler stub: records to Airtable and notifies Slack/email\nconst error = $input.all()[0].json.error || { message: 'Unknown' };\n// TODO: implement Airtable logging using env vars\nreturn [{ json: { handled: true, message: error.message } }];"\n      },\n      "notes": "This function is intended to be reused as an On Error subworkflow. Configure to record structured logs and alert ops."\n    }\n  ],\n  "connections": {},\n  "active": false,\n  "settings": {\n    "retry": { "maxRetries": 3, "backoffStrategy": "exponential", "initialIntervalSeconds": 2 },\n    "idempotency": { "enabled": true, "jobHashFields": ["payload.id","payload.timestamp"] }\n  },\n  "notes": "Refactor completo: modularizado, placeholders de env, validaciones y handler de errores. Mantener claves fuera del repo."\n}